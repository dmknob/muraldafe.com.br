<% let photos=[]; try { photos=JSON.parse(comunidade.fotos_galeria_json) || []; } catch (e) { photos=[]; } const
    heroImage=photos.length> 0 ? photos[0] : '/images/placeholder-church.jpg';
    %>

    <!-- Hero Section -->
    <!-- Hero Section -->
    <div class="relative w-full overflow-hidden" style="height: 60vh; min-height: 500px;">
        <div class="absolute inset-0 bg-black">
            <img src="<%= heroImage %>" alt="<%= comunidade.nome %>"
                class="w-full h-full object-cover opacity-50 blur-sm scale-110">
            <div class="absolute inset-0 bg-gradient-to-t from-primary via-black/40 to-transparent"></div>
        </div>

        <div class="absolute inset-0 flex items-center justify-center text-center p-4">
            <div class="max-w-4xl space-y-6">
                <% if (comunidade.padroeiro_nome) { %>
                    <div class="inline-block mb-4">
                        <span
                            class="bg-gold/10 border border-gold/30 text-gold px-4 py-1 rounded-full text-sm font-display uppercase tracking-widest backdrop-blur-md">
                            Intercessor:
                            <a href="/intercessores/<%= comunidade.padroeiro_slug %>"
                                class="hover:text-ivory hover:underline decoration-gold/50 transition-all">
                                <%= comunidade.padroeiro_nome %>
                            </a>
                        </span>
                    </div>
                    <% } %>

                        <h1 class="font-display text-4xl md:text-6xl text-ivory drop-shadow-2xl">
                            <%= comunidade.nome %>
                        </h1>

                        <div class="w-24 h-1 bg-gold mx-auto mt-8"></div>
            </div>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <div class="container mx-auto px-4 py-16 md:py-24 -mt-20 relative z-10">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">

            <!-- Coluna Principal: História -->
            <div class="lg:col-span-2 space-y-12">
                <div class="bg-zinc-950 p-8 md:p-12 rounded-xl border border-wine/20 shadow-2xl">
                    <h2 class="font-display text-2xl text-gold mb-8 flex items-center gap-3">
                        <span class="w-8 h-[1px] bg-gold/50"></span>
                        História e Significado
                    </h2>

                    <div
                        class="prose prose-invert prose-gold max-w-none font-serif text-lg leading-relaxed text-ivory/80 whitespace-pre-line first-letter:text-5xl first-letter:font-display first-letter:text-gold first-letter:mr-2 first-letter:float-left">
                        <%= comunidade.historia %>
                    </div>
                </div>

                <!-- Navegação -->
                <div class="flex justify-between items-center pt-8 border-t border-white/5">
                    <a href="/comunidades"
                        class="group flex items-center gap-3 text-ivory/50 hover:text-gold transition-colors">
                        <div
                            class="p-2 rounded-full border border-white/10 group-hover:border-gold/30 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                        </div>
                        <span class="font-display text-sm uppercase tracking-widest">Voltar para Comunidades</span>
                    </a>
                </div>

                <!-- Seção de Graças Vinculadas -->
                <% if (gracas && gracas.length> 0) { %>
                    <div class="mt-16 pt-16 border-t border-wine/20">
                        <h3 class="font-display text-2xl text-gold mb-8 flex items-center gap-3">
                            <span class="w-8 h-[1px] bg-gold/50"></span>
                            Graças Alcançadas
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <% gracas.forEach(grace=> { %>
                                <a href="/intercessores/<%= comunidade.padroeiro_id === 1 ? 'padre-reus' : 'nossa-senhora-da-santa-cruz-erechim' %>/<%= grace.slug %>"
                                    class="group block bg-zinc-900 border border-white/10 rounded-xl p-6 hover:border-gold/30 transition-all duration-300">
                                    <div class="flex items-start justify-between mb-4">
                                        <span
                                            class="bg-gold/10 text-gold text-xs px-2 py-1 rounded border border-gold/20 font-display">
                                            <%= grace.intercessor_nome %>
                                        </span>
                                        <span class="text-ivory/40 text-xs font-serif italic">
                                            <%= new Date(grace.criado_em).toLocaleDateString('pt-BR') %>
                                        </span>
                                    </div>

                                    <h4
                                        class="font-display text-lg text-ivory group-hover:text-gold transition-colors mb-2">
                                        <%= grace.nome_exibicao %>
                                    </h4>

                                    <p class="font-serif text-sm text-ivory/60 line-clamp-3 mb-4">
                                        <%= grace.resumo %>
                                    </p>

                                    <div
                                        class="flex items-center text-gold/60 text-xs font-display uppercase tracking-wider group-hover:text-gold transition-colors">
                                        Ler relato completo
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            class="h-4 w-4 ml-1 transform group-hover:translate-x-1 transition-transform"
                                            fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M17 8l4 4m0 0l-4 4m4-4H3" />
                                        </svg>
                                    </div>
                                </a>
                                <% }) %>
                        </div>
                    </div>
                    <% } %>
            </div>

            <!-- Sidebar: Galeria -->
            <div class="lg:col-span-1 space-y-8">
                <div class="bg-zinc-900/50 p-6 rounded-xl border border-white/5 sticky top-24">
                    <h3 class="font-display text-xl text-gold mb-6 text-center">Galeria de Fotos</h3>

                    <% if (photos.length> 0) { %>
                        <div class="grid grid-cols-2 gap-3">
                            <% photos.forEach((photo, index)=> { %>
                                <div class="relative aspect-square overflow-hidden rounded-lg group cursor-pointer border border-white/5 hover:border-gold/30 transition-all"
                                    onclick="openGalleryModal('<%= photo %>')">
                                    <img src="<%= photo %>" alt="Foto <%= index + 1 %>"
                                        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                                    <div
                                        class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            class="h-6 w-6 text-white drop-shadow-md" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                        <% } else { %>
                            <p class="text-center text-ivory/40 font-serif italic py-8">
                                Sem fotos disponíveis.
                            </p>
                            <% } %>
                </div>

                <% if (comunidade.site_url) { %>
                    <div class="bg-zinc-900/50 p-6 rounded-xl border border-white/5 mt-6">
                        <h3 class="font-display text-xl text-gold mb-4 text-center">Site Oficial</h3>
                        <a href="<%= comunidade.site_url %>" target="_blank" rel="noopener noreferrer"
                            class="group block bg-gradient-to-br from-wine/10 to-gold/5 border border-gold/20 rounded-lg p-4 hover:border-gold/40 hover:from-wine/20 hover:to-gold/10 transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3 flex-1 min-w-0">
                                    <div
                                        class="flex-shrink-0 p-2 rounded-full bg-gold/10 group-hover:bg-gold/20 transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gold" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                                        </svg>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p
                                            class="font-display text-sm text-ivory/90 group-hover:text-gold transition-colors truncate">
                                            Visitar Site
                                        </p>
                                        <p class="text-xs text-ivory/50 font-mono truncate">
                                            <%= comunidade.site_url.replace(/^https?:\/\//, '' ) %>
                                        </p>
                                    </div>
                                </div>
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    class="h-4 w-4 text-gold/60 group-hover:text-gold flex-shrink-0 transform group-hover:translate-x-1 transition-transform"
                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </div>
                        </a>
                    </div>
                    <% } %>
            </div>
        </div>
    </div>

    <!-- Modal de Galeria Simples -->
    <div id="gallery-modal"
        class="fixed inset-0 z-[100] hidden bg-black/95 backdrop-blur-md flex items-center justify-center p-4"
        onclick="closeGalleryModal()">
        <div class="relative max-w-5xl w-full max-h-[90vh]">
            <img id="gallery-image" src="" alt=""
                class="w-full h-full object-contain rounded-lg shadow-2xl border border-white/10">
            <button class="absolute -top-12 right-0 text-white/50 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <script>
        function openGalleryModal(src) {
            const modal = document.getElementById('gallery-modal');
            const img = document.getElementById('gallery-image');
            img.src = src;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeGalleryModal() {
            const modal = document.getElementById('gallery-modal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }
    </script>