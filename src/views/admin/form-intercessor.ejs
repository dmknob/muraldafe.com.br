<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="mb-8 flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-display text-gray-900">
                <%= intercessor ? 'Editar' : 'Novo' %> Intercessor
            </h1>
            <a href="/admin/intercessores" class="text-sm text-gold hover:text-wine font-medium">&larr; Voltar para
                lista</a>
        </div>
    </div>

    <% if (locals.error) { %>
        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
            <p>
                <%= error %>
            </p>
        </div>
        <% } %>

            <form
                action="<%= intercessor ? '/admin/intercessores/' + intercessor.id + '/editar' : '/admin/intercessores/novo' %>"
                method="POST" class="space-y-6">

                <input type="hidden" name="_csrf" value="<%= csrfToken %>">

                <!-- Informações Básicas -->
                <div class="bg-white shadow-sm rounded-lg border border-gray-200 p-6 space-y-6">

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Nome -->
                        <div>
                            <label for="nome" class="block text-sm font-medium text-gray-700">Nome do Intercessor
                                *</label>
                            <input type="text" name="nome" id="nome" required
                                value="<%= intercessor ? intercessor.nome : '' %>"
                                class="mt-1 focus:ring-gold focus:border-gold block w-full shadow-sm sm:text-sm border-gray-300 rounded-md py-2 px-3 border"
                                oninput="generateSlug()">
                        </div>

                        <!-- Slug -->
                        <div>
                            <label for="slug" class="block text-sm font-medium text-gray-700">Slug (URL) *</label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <span
                                    class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                                    /intercessores/
                                </span>
                                <input type="text" name="slug" id="slug" required
                                    value="<%= intercessor ? intercessor.slug : '' %>"
                                    class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md focus:ring-gold focus:border-gold sm:text-sm border-gray-300 border">
                            </div>
                            <p class="mt-1 text-xs text-gray-500">Único e sem espaços. Ex: padre-reus</p>
                        </div>
                    </div>

                    <!-- Imagem URL -->
                    <div>
                        <label for="imagem_url" class="block text-sm font-medium text-gray-700">URL da Imagem
                            (WebP)</label>
                        <input type="text" name="imagem_url" id="imagem_url"
                            value="<%= intercessor ? intercessor.imagem_url : '' %>"
                            class="mt-1 focus:ring-gold focus:border-gold block w-full shadow-sm sm:text-sm border-gray-300 rounded-md py-2 px-3 border"
                            placeholder="/uploads/intercessores/exemplo.webp ou https://...">
                        <p class="mt-1 text-xs text-gray-500">Cole a URL direta da imagem (hospedada externamente por
                            enquanto).</p>
                    </div>

                    <!-- Bio -->
                    <div>
                        <label for="historia_bio" class="block text-sm font-medium text-gray-700">Biografia /
                            História</label>
                        <textarea name="historia_bio" id="historia_bio" rows="5"
                            class="mt-1 focus:ring-gold focus:border-gold block w-full shadow-sm sm:text-sm border-gray-300 rounded-md py-2 px-3 border"><%= intercessor ? intercessor.historia_bio : '' %></textarea>
                    </div>

                    <!-- Oração -->
                    <div>
                        <label for="oracao" class="block text-sm font-medium text-gray-700">Oração</label>
                        <textarea name="oracao" id="oracao" rows="4"
                            class="mt-1 focus:ring-gold focus:border-gold block w-full shadow-sm sm:text-sm border-gray-300 rounded-md py-2 px-3 border"><%= intercessor ? intercessor.oracao : '' %></textarea>
                    </div>

                    <!-- Status -->
                    <div>
                        <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                        <select id="status" name="status"
                            class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-gold focus:border-gold sm:text-sm">
                            <option value="rascunho" <%=intercessor && intercessor.status==='rascunho' ? 'selected' : ''
                                %>
                                >Rascunho</option>
                            <option value="publicado" <%=intercessor && intercessor.status==='publicado' ? 'selected'
                                : '' %>>Publicado</option>
                        </select>
                    </div>

                    <div class="flex justify-end pt-5">
                        <a href="/admin/intercessores"
                            class="bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gold mr-3">
                            Cancelar
                        </a>
                        <button type="submit"
                            class="bg-wine border border-transparent rounded-md shadow-sm py-2 px-4 inline-flex justify-center text-sm font-medium text-white hover:bg-wine/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-wine">
                            Salvar
                        </button>
                    </div>
            </form>
</div>

<script>
    // Simple slug generator for client-side convenience
    // Only runs if creating new or slug field is empty/untouched
    const nomeInput = document.getElementById('nome');
    const slugInput = document.getElementById('slug');
    const isEdit = <%= intercessor ? 'true' : 'false' %>;

    function slugify(text) {
        return text.toString().toLowerCase()
            .replace(/\s+/g, '-')           // Replace spaces with -
            .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
            .replace(/\-\-+/g, '-')         // Replace multiple - with single -
            .replace(/^-+/, '')             // Trim - from start of text
            .replace(/-+$/, '');            // Trim - from end of text
    }

    function generateSlug() {
        if (!isEdit || slugInput.value === '') {
            slugInput.value = slugify(nomeInput.value);
        }
    }
</script>